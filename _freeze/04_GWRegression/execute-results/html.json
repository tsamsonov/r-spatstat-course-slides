{
  "hash": "db7db2460db4a6b9c82d626f53a98c51",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Географически взвешенная регрессия\"\nsubtitle: \"Пространственная статистика\"\ndate: today\ndate-format: long\nauthor: \"Самсонов Тимофей Евгеньевич\"\nexecute:\n  echo: false\n  freeze: true\nengine: knitr\nformat:\n  revealjs: \n    theme: [default, custom.scss]\n    margin: 0.2\n    width: 1280\n    height: 720\n    slide-number: true\n    footer: \"Самсонов Т. Е. Пространственная статистика: курс лекций\"\n    header-includes: <link rel=\"stylesheet\" media=\"screen\" href=\"https://fontlibrary.org//face/pt-sans\" type=\"text/css\"/>\nbibliography: references.yaml\nmainfont: PT Sans\n---\n\n\n## Особенности случайных процессов в пространстве\n\n-   **Пространственная зависимость** *(spatial dependence)* — наличие автокорреляции наблюдений. Выражается в невыполнении условия независимости остатков линейной регрессии. Устраняется посредством *пространственной регрессии (spatial regression)*.\n\n-   **Пространственная гетерогенность** *(spatial heterogeneity)* — нестационарность процессов, порождающих наблюдаемую переменную. Выражается в неэффективности постоянных коэффициентов линейной регрессии. Устраняется постредством *географически взвешенной регрессии (geographically weighted regression)*.\n\n## Географически взвешенная регрессия\n\nВ стандартной модели линейной регрессии параметры модели предполагаются постоянными:\n\n$$\\mathbf{y} = \\mathbf{X} \\boldsymbol\\beta + \\boldsymbol\\epsilon,$$\n\nДля $i$-й локации решение выглядит следующим образом:\n\n$$y_i = \\beta_0 + \\beta_1 x_{1i} + \\beta_2 x_{2i} + ... + \\beta_m x_{mi} + \\epsilon_i$$\n\nКоэффициенты находятся методом наименьших квадратов:\n\n$$\\mathbf{\\beta}' = (\\mathbf{X}^T\\mathbf{X})^{-1} \\mathbf{X}^T \\mathbf{Y}$$\n\nТакой подход, однако не учитывает того, что характер зависимости между переменными может меняться по пространству.\n\n## Географически взвешенная регрессия\n\nВ географически взвешенной регрессионной модели веса определяются для каждой локации:\n\n$$y_i = \\beta_{0i} + \\beta_{1i} x_{1i} + \\beta_{2i} x_{2i} + ... + \\beta_{mi} x_{mi} + \\epsilon_i$$\n\nВ этом случае область оценки параметров $\\mathbf{\\beta}$ ограничивается некой окрестностью точки $i$. Математически это достигается применением весовых коэффициентов для данных независимых переменных:\n\n$$\\mathbf{\\beta}'(i) = (\\mathbf{X}^T \\color{blue}{\\mathbf{W}(i)}\\mathbf{X})^{-1} \\mathbf{X}^T \\color{blue}{\\mathbf{W}(i)} \\mathbf{Y},$$\n\nгде $\\mathbf{W}(i)$ есть матрица весов для точки $i$. Коэффициенты матрицы подбираются таким образом, что близкие локации получают более высокий вес.\n\n## Географически взвешенная регрессия\n\nМатрица $\\mathbf{W}(i)$ имеет размер $n \\times n$, где $n$ — число точек наблюдений:\n\n$$\\mathbf{W}(i) = \\begin{bmatrix}\n    w_{i1} & 0 & 0 & \\dots  & 0 \\\\\n    0 & w_{i2} & 0 & \\dots  & 0 \\\\\n    0 & 0 & w_{i3} & \\dots  & 0 \\\\\n    \\vdots & \\vdots & \\vdots & \\ddots & \\vdots \\\\\n    0 & 0 & 0 & \\dots  & w_{in}\n\\end{bmatrix},$$\n\nгде $w_{ik}$ есть вес, который имеет точка $k$ при локальной оценке параметров в точке $i$.\n\n## Весовая функция\n\nДалёкие точки должны иметь меньший вес при вычислении коэффициентов. Например, для *гауссовой* весовой функции:\n\n$$\nw_{ij} = \\operatorname{exp}\\Big\\{-\\frac{1}{2} (d_{ij}/h)^2\\Big\\},\n$$\n\n::: columns\n::: {.column width=\"50%\"}\n-   $w_{ij}$ --- вес, который будет иметь $j$-я точка при вычислении коэффициентов регрессии в $i$-й точке;\n\n-   $d_{ij}$ расстояние между ними;\n\n-   $h$ --- полоса пропускания\n:::\n\n::: {.column width=\"50%\"}\n![](images/gwr_weights.svg){width=\"100%\"}\n:::\n:::\n\n## Весовые функции\n\nВ случае фиксированной весовой функции окрестность всегда имеет фиксированную полосу пропускания:\n\n![](images/nbfixed.svg){width=\"100%\"}\n\n## Весовые функции\n\nВ случае адаптивной весовой функции полоса пропускания определяется $N$ ближайшими точками. Например для $N = 5$:\n\n![](images/nbvariable.svg){width=\"100%\"}\n\n## Полоса пропускания\n\n$$w_{ij} = \\operatorname{exp}\\Big\\{-\\frac{1}{2} (d_{ij}/h)^2\\Big\\},$$\n\n**Полоса пропускания** $h$ обладает следующими особенностями:\n\n-   малая полоса пропускания приводит к большой дисперсии локальных оценок;\n-   большая полоса пропускания приводит к смещенности оценки;\n-   при $h \\rightarrow \\infty$ локальная модель приближается к *глобальной регрессии*;\n-   при $h \\rightarrow 0$ локальная модель «сворачивается» вокруг данных.\n\n## Практический анализ\n\nВ качестве примера проанализируем каким образом цена жилья зависит от количества комнат на примере данных по стоимости недвижимости в Бостоне:\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](04_GWRegression_files/figure-revealjs/unnamed-chunk-2-1.png){width=1200}\n:::\n:::\n\n\n## Обычная регрессия\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](04_GWRegression_files/figure-revealjs/unnamed-chunk-3-1.png){width=1800}\n:::\n:::\n\n\nКоэффициент детерминации $R^2 = 0.1483$. Регрессионная модель:\n\n$$\n\\texttt{price} = 2319.2 +421.8~\\texttt{rooms}\n$$\n\n## Модель ГВР\n\nВ случае модели ГВР получается множество коэффициентов регрессии. По ним можно узнать статистику\n\n\n::: {.cell}\n\n:::\n\n\n```         \n              Min.   1st Qu. Median  3rd Qu. Max.\n   Intercept  198.56 1785.17 2054.43 2361.79 3485.2\n   rooms     -409.97  471.77  524.01  650.52 1299.1\n   \n   Kernel function: gaussian \n   Fixed bandwidth: 1000 \n   Regression points: the same locations as observations are used.\n   Distance metric: Euclidean distance metric is used\n```\n\nКоэффициент детерминации $R^2 = 0.367$.\n\n## Коэффициенты ГВР\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](04_GWRegression_files/figure-revealjs/unnamed-chunk-5-1.png){width=900}\n:::\n:::\n\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](04_GWRegression_files/figure-revealjs/unnamed-chunk-6-1.png){width=900}\n:::\n:::\n\n:::\n:::\n\nПространственная картина распределения коэффициентов регрессии подтверждает гипотезу о гетерогенности.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}